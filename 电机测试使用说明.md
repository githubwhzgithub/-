# 电机测试模块使用说明

## 概述
电机测试模块用于独立测试平衡车的左电机(H4)和右电机(H5)是否正常工作。该模块提供了多种测试方式，包括自动测试序列和手动控制命令。

## 硬件连接
- **左电机 (H4)**: 连接到TB6612的Motor A
- **右电机 (H5)**: 连接到TB6612的Motor B
- **控制引脚**: 
  - AO1, AO2: 左电机方向控制
  - BO1, BO2: 右电机方向控制
  - PWMA: 左电机速度控制
  - PWMB: 右电机速度控制

## 蓝牙控制命令

### 自动测试命令
- `MTEST`: 开始完整的自动测试序列
- `MTEST STOP`: 停止当前测试
- `MTEST STATUS`: 查看当前测试状态

### 手动控制命令
- `MLEFT [speed]`: 测试左电机 (H4)
  - 示例: `MLEFT 300` (以30%速度正转)
  - 示例: `MLEFT -300` (以30%速度反转)
- `MRIGHT [speed]`: 测试右电机 (H5)
  - 示例: `MRIGHT 500` (以50%速度正转)
  - 示例: `MRIGHT -500` (以50%速度反转)
- `MBOTH [speed]`: 同时测试两个电机
  - 示例: `MBOTH 400` (两个电机都以40%速度正转)
- `MSTOP`: 立即停止所有电机
- `MSPEED [value]`: 设置默认测试速度 (0-1000)
  - 示例: `MSPEED 600` (设置默认速度为60%)

## 自动测试序列

自动测试将按以下顺序执行：

1. **左电机测试**
   - 正转 2秒 (默认速度)
   - 停止 1秒
   - 反转 2秒
   - 停止 1秒

2. **右电机测试**
   - 正转 2秒 (默认速度)
   - 停止 1秒
   - 反转 2秒
   - 停止 1秒

3. **双电机同步测试**
   - 同时正转 2秒
   - 停止 1秒
   - 同时反转 2秒
   - 停止 1秒

4. **速度渐变测试**
   - 从0逐渐加速到最大速度
   - 从最大速度逐渐减速到0

5. **方向切换测试**
   - 快速正反转切换测试

6. **刹车测试**
   - 测试电机刹车功能

## 使用步骤

### 基本测试流程
1. 确保平衡车已正确连接电源和蓝牙
2. 发送 `GO` 命令建立蓝牙连接
3. 发送 `MTEST` 开始自动测试
4. 观察电机运行情况
5. 测试完成后会自动停止

### 手动测试流程
1. 建立蓝牙连接 (`GO`)
2. 测试左电机: `MLEFT 300`
3. 停止电机: `MSTOP`
4. 测试右电机: `MRIGHT 300`
5. 停止电机: `MSTOP`
6. 测试双电机: `MBOTH 300`
7. 停止电机: `MSTOP`

## 参数说明

- **速度范围**: -1000 到 1000
  - 正值: 正转
  - 负值: 反转
  - 0: 停止
  - 1000: 最大速度 (100% PWM)
- **默认测试速度**: 300 (30% PWM)
- **测试步骤持续时间**: 2000ms (2秒)

## 故障排除

### 电机不转动
1. 检查电源连接
2. 检查TB6612模块连接
3. 检查电机连接线
4. 发送 `MTEST STATUS` 查看状态

### 电机转向错误
1. 检查AO1/AO2和BO1/BO2连接
2. 可能需要交换电机正负极

### 速度异常
1. 检查PWM信号连接
2. 检查电源电压是否足够
3. 尝试降低测试速度

## 安全注意事项

1. 测试时确保平衡车放置在安全位置
2. 避免在测试过程中触碰旋转的电机
3. 如发现异常立即发送 `MSTOP` 停止测试
4. 测试完成后记得关闭电源

## 示例测试会话

```
用户: GO
系统: Connected!

用户: MTEST
系统: Motor test started - Auto sequence
系统: Testing left motor forward...
系统: Testing left motor backward...
系统: Testing right motor forward...
系统: Testing right motor backward...
系统: Testing both motors forward...
系统: Testing both motors backward...
系统: Speed ramp test...
系统: Direction change test...
系统: Brake test...
系统: Motor test completed!

用户: MLEFT 500
系统: Left motor forward at speed 500

用户: MSTOP
系统: All motors stopped

用户: MTEST STATUS
系统: Motor test status: Idle
```

通过这个测试模块，您可以全面验证平衡车电机系统的功能，确保硬件连接正确且工作正常。